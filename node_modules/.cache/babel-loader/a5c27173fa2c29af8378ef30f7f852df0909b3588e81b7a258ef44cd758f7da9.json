{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, watch } from \"vue\";\nimport foodCart from \"./foodCart.vue\";\nimport { getFoods, getThisTicket, postFoodBill } from \"@/api/api\";\nimport { ElMessage, ElNotification } from \"element-plus\";\nconst userID = \"00000\"; //当前用户ID\n\nexport default {\n  __name: 'bookFood',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const tid = ref(\"\");\n    const date = ref(\"\");\n    const time = ref(\"lunch\");\n    const foodList = ref([]);\n    const order_foods = ref([]); //已点的食物\n    const Paidticket = ref([]);\n    const search = () => {\n      if (tid.value === \"\" || time.value === \"\" || date.value === \"\") {\n        ElMessage({\n          message: \"还有没填写的信息\",\n          type: \"error\",\n          plain: true\n        });\n      } else {\n        fetchFoods();\n      }\n    };\n    const fetchFoods = async () => {\n      try {\n        const response = await getFoods(userID, tid, date, time);\n        if (response.data.haveTicket) {\n          foodList.value = response.data.result;\n          ElMessage({\n            message: \"查询成功\",\n            type: \"success\"\n          });\n        } else {\n          ElMessage.error(\"查询失败T^T\" + response.data.info);\n          foodList.value = [];\n        }\n      } catch (error) {\n        console.error(\"获取食物数组失败:\", error);\n      }\n    };\n    const fetchTids = async () => {\n      try {\n        const response = await getThisTicket(userID, \"paid\");\n        var ticket = response.data.result;\n        var tempList = [];\n        for (var item of ticket) {\n          tempList.push(item.tid);\n        }\n        Paidticket.value = tempList;\n      } catch (error) {\n        console.error(\"获取车站数组失败：\", error);\n      }\n    };\n    const submitBill = async sum_price => {\n      try {\n        const responce = await (order_foods, userID, tid, date, time, sum_price);\n        if (responce.data.result) {\n          ElNotification({\n            title: '订单已提交',\n            message: '您成功预订了火车餐！预祝您用餐愉快~',\n            type: 'success'\n          });\n        } else {\n          ElNotification({\n            title: '提交订单失败T^T',\n            message: responce.data.info,\n            type: 'error'\n          });\n        }\n      } catch (error) {\n        console.log(\"提交订单失败：\", error);\n        ElNotification({\n          title: '提交订单失败T^T',\n          message: '网络似乎开小差了~',\n          type: 'error'\n        });\n      }\n    };\n    watch(foodList, newFoodList => {\n      // 当 num 大于 0 时，将该项加入 order_foods\n      order_foods.value = newFoodList.filter(item => item.num > 0);\n      console.log(\"修改了购物车内容\");\n    }, {\n      deep: true\n    }, {\n      immediate: true\n    });\n    onMounted(() => {\n      fetchTids();\n    });\n    const __returned__ = {\n      userID,\n      tid,\n      date,\n      time,\n      foodList,\n      order_foods,\n      Paidticket,\n      search,\n      fetchFoods,\n      fetchTids,\n      submitBill,\n      ref,\n      onMounted,\n      watch,\n      foodCart,\n      get getFoods() {\n        return getFoods;\n      },\n      get getThisTicket() {\n        return getThisTicket;\n      },\n      get postFoodBill() {\n        return postFoodBill;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElNotification() {\n        return ElNotification;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","foodCart","getFoods","getThisTicket","postFoodBill","ElMessage","ElNotification","userID","tid","date","time","foodList","order_foods","Paidticket","search","value","message","type","plain","fetchFoods","response","data","haveTicket","result","error","info","console","fetchTids","ticket","tempList","item","push","submitBill","sum_price","responce","title","log","newFoodList","filter","num","deep","immediate"],"sources":["D:/University/sophomore/Software engineering/werwer_train/src/components/bookFood.vue"],"sourcesContent":["<template>\r\n  <div style=\"width: 100%; height: 100%\">\r\n    <div style=\"width: 100%; margin-bottom: 5%; height: 10%\">\r\n      <v-card\r\n        hover\r\n        style=\"\r\n          background-color: #e4f5ff;\r\n          border-radius: 25px;\r\n          width: 100%;\r\n          height: 100%;\r\n          display: block;\r\n        \"\r\n      >\r\n        <div class=\"select\">\r\n          <el-select\r\n            v-model=\"tid\"\r\n            placeholder=\"车次\"\r\n            class=\"item\"\r\n            :popper-class=\"popperClass\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in Paidticket\"\r\n              :key=\"item\"\r\n              :label=\"item\"\r\n              :value=\"item\"\r\n            >\r\n            </el-option>\r\n          </el-select>\r\n          <el-date-picker\r\n            class=\"item\"\r\n            v-model=\"date\"\r\n            type=\"date\"\r\n            placeholder=\"出发日期\"\r\n            :shortcuts=\"shortcuts\"\r\n            :size=\"20\"\r\n          />\r\n          <el-popover\r\n            placement=\"top-start\"\r\n            width=\"13em\"\r\n            trigger=\"hover\"\r\n            content=\"午餐点为12:00--14:00  晚餐点为17:00--19:00\"\r\n          >\r\n            <template #reference>\r\n              <el-radio-group\r\n                v-model=\"time\"\r\n                style=\"\r\n                  margin-right: 10px;\r\n                  margin-left: 10px;\r\n                  flex: 0.3;\r\n                  justify-content: center;\r\n                \"\r\n              >\r\n                <el-radio-button label=\"午餐\" value=\"lunch\" />\r\n                <el-radio-button label=\"晚餐\" value=\"dinner\" /> </el-radio-group\r\n            ></template>\r\n          </el-popover>\r\n          <el-icon style=\"flex: 0.1\">\r\n            <Search\r\n              @click=\"search\"\r\n              style=\"\r\n                background-color: orange;\r\n                width: 30px;\r\n                height: 200%;\r\n                border-radius: 5px;\r\n              \"\r\n            />\r\n          </el-icon>\r\n        </div>\r\n      </v-card>\r\n    </div>\r\n\r\n    <div class=\"container\">\r\n      <div v-for=\"(item, index) in foodList\" :key=\"index\">\r\n        <div style=\"display: flex; flex-wrap: wrap; margin: 2.5%\">\r\n          <el-card shadow=\"hover\">\r\n            <template #header>\r\n              <div style=\"display: flex; justify-content: space-between\">\r\n                <div>{{ item.name }}</div>\r\n                <div style=\"font-weight: bold; color: #ffa31a\">\r\n                  ￥{{ item.price }}\r\n                </div>\r\n              </div>\r\n            </template>\r\n            <img\r\n              loading=\"lazy\"\r\n              referrerpolicy=\"no-referrer\"\r\n              object-fit=\"contain\"\r\n              :src=\"item.photo\"\r\n              style=\"\r\n                width: 15em;\r\n                height: 15em;\r\n                display: block;\r\n                margin-left: auto;\r\n                margin-right: auto;\r\n              \"\r\n            />\r\n            <template #footer>\r\n              <div style=\"display: flex; justify-content: space-between\">\r\n                <text>数量</text>\r\n                <el-input-number v-model=\"item.num\" size=\"small\" :min=\"0\" />\r\n              </div>\r\n            </template>\r\n          </el-card>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div style=\"position: fixed; bottom: 2%; right: 1%\">\r\n    <foodCart v-model=\"order_foods\" @getPaid=\"submitBill\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, watch } from \"vue\";\r\nimport foodCart from \"./foodCart.vue\";\r\nimport { getFoods, getThisTicket, postFoodBill } from \"@/api/api\";\r\nimport { ElMessage,ElNotification  } from \"element-plus\";\r\nconst userID = \"00000\"; //当前用户ID\r\nconst tid = ref(\"\");\r\nconst date = ref(\"\"); \r\nconst time = ref(\"lunch\");\r\nconst foodList = ref([]);\r\n\r\nconst order_foods = ref([]); //已点的食物\r\nconst Paidticket = ref([]);\r\nconst search = () => {\r\n  if (tid.value === \"\" || time.value === \"\" || date.value === \"\") {\r\n    ElMessage({\r\n      message: \"还有没填写的信息\",\r\n      type: \"error\",\r\n      plain: true,\r\n    });\r\n  } else {\r\n    fetchFoods();\r\n  }\r\n};\r\nconst fetchFoods = async () => {\r\n  try {\r\n    const response = await getFoods(userID,tid, date, time);\r\n    if (response.data.haveTicket) {\r\n      foodList.value = response.data.result;\r\n      ElMessage({\r\n        message: \"查询成功\",\r\n        type: \"success\",\r\n      });\r\n    } else {\r\n      ElMessage.error(\"查询失败T^T\" + response.data.info);\r\n      foodList.value = [];\r\n    }\r\n  } catch (error) {\r\n    console.error(\"获取食物数组失败:\", error);\r\n  }\r\n};\r\n\r\nconst fetchTids = async () => {\r\n  try {\r\n    const response = await getThisTicket(userID, \"paid\");\r\n    var ticket = response.data.result;\r\n    var tempList = [];\r\n    for (var item of ticket) {\r\n      tempList.push(item.tid);\r\n    }\r\n    Paidticket.value = tempList;\r\n  } catch (error) {\r\n    console.error(\"获取车站数组失败：\", error);\r\n  }\r\n};\r\nconst submitBill = async (sum_price) =>{\r\n  try{\r\n  const responce = await (order_foods, userID, tid, date, time, sum_price);\r\n  if(responce.data.result)\r\n  {ElNotification({\r\n    title: '订单已提交',\r\n    message: '您成功预订了火车餐！预祝您用餐愉快~',\r\n    type: 'success',\r\n  })}\r\n  else{\r\n    ElNotification({\r\n    title: '提交订单失败T^T',\r\n    message: responce.data.info,\r\n    type: 'error',\r\n  })\r\n  }\r\n}catch (error){\r\n    console.log(\"提交订单失败：\",error);\r\n    ElNotification({\r\n    title: '提交订单失败T^T',\r\n    message: '网络似乎开小差了~',\r\n    type: 'error',\r\n  })\r\n  }\r\n};\r\n\r\nwatch(\r\n  foodList,\r\n  (newFoodList) => {\r\n    // 当 num 大于 0 时，将该项加入 order_foods\r\n    order_foods.value = newFoodList.filter((item) => item.num > 0);\r\n    console.log(\"修改了购物车内容\");\r\n  },\r\n  { deep: true },\r\n  { immediate: true }\r\n);\r\nonMounted(() => {\r\n  fetchTids();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.item {\r\n  flex: 1;\r\n  margin-right: 10px;\r\n  margin-left: 10px;\r\n  margin: auto;\r\n}\r\n.container {\r\n  display: flex;\r\n  flex-wrap: wrap; /* 设置子元素自动换行 */\r\n  justify-content: center;\r\n  position: absolute;\r\n  z-index: 0;\r\n  background-color: white;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}