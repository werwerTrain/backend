{"ast":null,"code":"import { onMounted, ref, watch } from \"vue\";\nimport { getThisTicket, cancelTicketOrder } from \"../../api/api.js\";\nimport { ElMessage } from \"element-plus\";\nconst userID = \"0000\";\nexport default {\n  __name: 'myTicket',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const status = ref(\"all\");\n    const ticketOrders = ref([]);\n    const cancelOrders = async oid => {\n      try {\n        const responce = await cancelTicketOrder(userID, oid);\n        if (responce.data.result) {\n          ElMessage({\n            message: '取消订单成功，退款将原路返回。',\n            type: \"success\"\n          });\n          //TODO 通知消息弹窗\n        } else {\n          ElMessage.error(\"取消订单失败\");\n        }\n      } catch (error) {\n        console.error(\"取消订单失败\", error);\n        ElMessage.error(\"取消订单失败\");\n      }\n      getOrders();\n    };\n    const getStatusColor = status => {\n      if (status === '已完成') {\n        return '#60B2FF';\n      } else if (status === '已支付') {\n        return '#24D36F';\n      } else if (status === '已取消') {\n        return '#FC604F';\n      }\n    };\n    const getOrders = async () => {\n      try {\n        const response = await getThisTicket(userID, status.value);\n        ticketOrders.value = response.data.result;\n      } catch (error) {\n        console.error(\"获取本人订单数组失败:\", error);\n      }\n    };\n    watch(status, newValue => {\n      // console.log(\"状态切换为\", newValue);\n      getOrders();\n    });\n    onMounted(() => {\n      getOrders();\n    });\n    const __returned__ = {\n      status,\n      userID,\n      ticketOrders,\n      cancelOrders,\n      getStatusColor,\n      getOrders,\n      onMounted,\n      ref,\n      watch,\n      get getThisTicket() {\n        return getThisTicket;\n      },\n      get cancelTicketOrder() {\n        return cancelTicketOrder;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["onMounted","ref","watch","getThisTicket","cancelTicketOrder","ElMessage","userID","status","ticketOrders","cancelOrders","oid","responce","data","result","message","type","error","console","getOrders","getStatusColor","response","value","newValue"],"sources":["D:/University/sophomore/Software engineering/werwer_train/src/components/orders/myTicket.vue"],"sourcesContent":["<template>\r\n    <el-radio-group v-model=\"status\">\r\n        <el-radio-button label=\"全部订单\" value=\"all\"></el-radio-button>\r\n        <el-radio-button label=\"已支付\" value=\"paid\"></el-radio-button>\r\n        <el-radio-button label=\"已取消\" value=\"cancle\"></el-radio-button>\r\n        <el-radio-button label=\"已完成\" value=\"done\"></el-radio-button>\r\n    </el-radio-group>\r\n    <div v-for=\"(item, index) in ticketOrders\" :key=\"index\">\r\n        <el-card style=\"width: 100%;border-radius: 25px;margin-top:1%;margin-bottom:1%;\">\r\n            <template #header>\r\n                <el-row>\r\n                    <el-col :span=\"7\">\r\n                        <el-text tag=\"b\" size=\"large\">订单号: {{ item.oid }}</el-text>\r\n                    </el-col>\r\n                    <el-col :span=\"7\">\r\n                        <el-text tag=\"b\" size=\"large\">下单时间: {{ item.order_time }}</el-text>\r\n                    </el-col>\r\n                    <el-col :span=\"7\">\r\n                        <el-text tag=\"b\" size=\"large\">出发日期: {{ item.date }}</el-text>\r\n                    </el-col>\r\n                    <el-col :span=\"3\">\r\n                        <el-text tag=\"b\" size=\"large\">订单状态: <span :style=\"{ color: getStatusColor(item.status) }\">{{\r\n        item.status }}</span></el-text>\r\n                    </el-col>\r\n                </el-row>\r\n            </template>\r\n            <div style=\"display:block;\">\r\n                <el-text size=\"large\" style=\"margin-bottom:1%;\">车次信息</el-text>\r\n                <el-row>\r\n                    <el-col :span=\"6\" style=\"display: flex;flex-direction: column;justify-content: center;\">\r\n                        <el-text tag=\"b\" style=\"font-size: 25px;\">{{ item.start_time }}</el-text>\r\n                        <el-text size=\"large\" style=\"width\">{{ item.start_station }}</el-text>\r\n                    </el-col>\r\n                    <el-col :span=\"6\" style=\"display: flex;flex-direction: column;justify-content: center;\">\r\n                        <el-divider content-position=\"center\"><el-text tag=\"b\" size=\"large\"\r\n                                style=\"font-size:20px;padding:5px 35px;border:1.5px solid #DDDCDC;border-radius: 10px;\">{{\r\n        item.tid }}</el-text></el-divider>\r\n                    </el-col>\r\n                    <el-col :span=\"6\"\r\n                        style=\"display: flex;flex-direction: column;justify-content: center;border-right:1.5px solid #DDDCDC;\">\r\n                        <el-text tag=\"b\" style=\"font-size: 25px;\">{{ item.arrive_time }}</el-text>\r\n                        <el-text size=\"large\" style=\"width\">{{ item.arrive_station }}</el-text>\r\n                    </el-col>\r\n                    <el-col :span=\"6\" style=\"display: flex;flex-direction: column;justify-content: center;\">\r\n                        <el-text tag=\"b\" style=\"font-size: 25px;\">{{ item.time }}</el-text>\r\n                        <el-text size=\"large\" style=\"width\">{{ item.seat_type }}</el-text>\r\n                    </el-col>\r\n                </el-row>\r\n            </div>\r\n            <template #footer>\r\n                <el-row>\r\n                    <el-col :span=\"3\">\r\n                        <el-text class=\"mx-1\" size=\"large\">总金额: <span style=\"color:#ffa31a;font-weight: bold;\">￥{{\r\n        item.price\r\n    }}元</span></el-text>\r\n                    </el-col>\r\n                    <el-col :span=\"2\" v-if=\"item.status === '已支付'\" :offset=\"19\">\r\n                        <el-popconfirm title=\"确定要取消这个订单吗？\" @confirm=\"cancelOrders(item.oid)\">\r\n                            <template #reference>\r\n                                <el-button type=\"warning\" plain style=\"margin-top:-1%;\">取消订单</el-button>\r\n                            </template>\r\n                        </el-popconfirm>\r\n                    </el-col>\r\n                </el-row>\r\n            </template>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n<script setup>\r\nimport { onMounted, ref, watch } from \"vue\";\r\nimport { getThisTicket, cancelTicketOrder } from \"../../api/api.js\";\r\nimport { ElMessage } from \"element-plus\";\r\nconst status = ref(\"all\");\r\nconst userID = \"0000\";\r\nconst ticketOrders = ref([]);\r\nconst cancelOrders = async (oid) => {\r\n    try {\r\n        const responce = await cancelTicketOrder(userID, oid);\r\n        if (responce.data.result) {\r\n            ElMessage({\r\n                message: '取消订单成功，退款将原路返回。',\r\n                type: \"success\",\r\n            });\r\n            //TODO 通知消息弹窗\r\n        }\r\n        else {\r\n            ElMessage.error(\"取消订单失败\");\r\n        }\r\n    } catch (error) {\r\n        console.error(\"取消订单失败\", error);\r\n        ElMessage.error(\"取消订单失败\");\r\n    }\r\n    getOrders();\r\n}\r\nconst getStatusColor = (status) => {\r\n    if (status === '已完成') {\r\n        return '#60B2FF';\r\n    } else if (status === '已支付') {\r\n        return '#24D36F';\r\n    } else if (status === '已取消') {\r\n        return '#FC604F';\r\n    }\r\n};\r\nconst getOrders = async () => {\r\n    try {\r\n        const response = await getThisTicket(userID, status.value);\r\n        ticketOrders.value = response.data.result;\r\n    } catch (error) {\r\n        console.error(\"获取本人订单数组失败:\", error);\r\n    }\r\n};\r\nwatch(status, (newValue) => {\r\n    // console.log(\"状态切换为\", newValue);\r\n    getOrders();\r\n});\r\nonMounted(() => {\r\n    getOrders();\r\n});\r\n</script>\r\n<style scoped>\r\n.el-card /deep/ .el-card__header {\r\n    background-color: #f0f8ff;\r\n}\r\n</style>"],"mappings":"AAqEA,SAASA,SAAS,EAAEC,GAAG,EAAEC,KAAK,QAAQ,KAAK;AAC3C,SAASC,aAAa,EAAEC,iBAAiB,QAAQ,kBAAkB;AACnE,SAASC,SAAS,QAAQ,cAAc;AAExC,MAAMC,MAAM,GAAG,MAAM;;;;;;;IADrB,MAAMC,MAAM,GAAGN,GAAG,CAAC,KAAK,CAAC;IAEzB,MAAMO,YAAY,GAAGP,GAAG,CAAC,EAAE,CAAC;IAC5B,MAAMQ,YAAY,GAAG,MAAOC,GAAG,IAAK;MAChC,IAAI;QACA,MAAMC,QAAQ,GAAG,MAAMP,iBAAiB,CAACE,MAAM,EAAEI,GAAG,CAAC;QACrD,IAAIC,QAAQ,CAACC,IAAI,CAACC,MAAM,EAAE;UACtBR,SAAS,CAAC;YACNS,OAAO,EAAE,iBAAiB;YAC1BC,IAAI,EAAE;UACV,CAAC,CAAC;UACF;QACJ,CAAC,MACI;UACDV,SAAS,CAACW,KAAK,CAAC,QAAQ,CAAC;QAC7B;MACJ,CAAC,CAAC,OAAOA,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAAC;QAC9BX,SAAS,CAACW,KAAK,CAAC,QAAQ,CAAC;MAC7B;MACAE,SAAS,CAAC,CAAC;IACf,CAAC;IACD,MAAMC,cAAc,GAAIZ,MAAM,IAAK;MAC/B,IAAIA,MAAM,KAAK,KAAK,EAAE;QAClB,OAAO,SAAS;MACpB,CAAC,MAAM,IAAIA,MAAM,KAAK,KAAK,EAAE;QACzB,OAAO,SAAS;MACpB,CAAC,MAAM,IAAIA,MAAM,KAAK,KAAK,EAAE;QACzB,OAAO,SAAS;MACpB;IACJ,CAAC;IACD,MAAMW,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC1B,IAAI;QACA,MAAME,QAAQ,GAAG,MAAMjB,aAAa,CAACG,MAAM,EAAEC,MAAM,CAACc,KAAK,CAAC;QAC1Db,YAAY,CAACa,KAAK,GAAGD,QAAQ,CAACR,IAAI,CAACC,MAAM;MAC7C,CAAC,CAAC,OAAOG,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,aAAa,EAAEA,KAAK,CAAC;MACvC;IACJ,CAAC;IACDd,KAAK,CAACK,MAAM,EAAGe,QAAQ,IAAK;MACxB;MACAJ,SAAS,CAAC,CAAC;IACf,CAAC,CAAC;IACFlB,SAAS,CAAC,MAAM;MACZkB,SAAS,CAAC,CAAC;IACf,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}